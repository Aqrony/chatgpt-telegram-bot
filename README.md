# Чат-бот Telegram ChatGPT
![python-version](https://img.shields.io/badge/python-3.9-blue.svg)
[![openai-version](https://img.shields.io/badge/openai-0.27.2-orange.svg)](https://openai.com/)
[![license](https://img.shields.io/badge/License-GPL%202.0-brightgreen.svg)](LICENSE)
[![Publish Docker image](https://github.com/n3d1117/chatgpt-telegram-bot/actions/workflows/publish.yaml/badge.svg)](https://github.com/n3d1117/chatgpt-telegram-bot/actions/workflows/publish.yaml)

[Telegram-бот](https://core.telegram.org/bots/api), который интегрируется с API [ChatGPT](https://openai.com/blog/chatgpt/) от OpenAI для предоставления ответов. Готов к использованию с минимальной настройкой.

## Скриншоты
![demo](https://user-images.githubusercontent.com/11541888/225114786-0d639854-b3e1-4214-b49a-e51ce8c40387.png)

## Функциональность
- [x] Поддержка Markdown в ответах
- [x] Сброс конверсации с помощью команды `/reset`
- [x] Индикатор набора при генерации ответа
- [x] Доступ может быть ограничен путем указания списка разрешенных пользователей
- [x] Поддержка Docker и Proxy
- [x] (НОВОЕ!) Генерация изображения с использованием DALL·E через команду `/image`
- [x] (НОВОЕ!) Транскрипция аудио- и видеосообщений с помощью Whisper (может потребоваться [ffmpeg](https://ffmpeg.org))
- [x] (НОВОЕ!) Автоматическая сводка разговора для предотвращения избыточного использования токенов (исправление [#34](https://github.com/n3d1117/chatgpt-telegram-bot/issues/34))
- [x] (НОВОЕ!) Поддержка группового чата с встроенными запросами 
  - Чтобы использовать эту функцию, включите встроенные запросы для своего бота в BotFather через команду `/setinline` [command](https://core.telegram.org/bots/inline)
- [x] (НОВОЕ!) Отслеживание использования токенов на пользователя - от [@AlexHTW](https://github.com/AlexHTW)
- [x] (НОВОЕ!) Получение статистики использования токенов на день/месяц на пользователя - от [@AlexHTW](https://github.com/AlexHTW)
- [x] (НОВОЕ!) Лимиты на бюджеты пользователя и гостей - от [@AlexHTW](https://github.com/AlexHTW)
- [x] (НОВОЕ!) Поддержка потоковой передачи
- [x] (НОВОЕ!) Поддержка GPT-4
  - Если у вас есть доступ к API GPT-4, просто измените параметр `OPENAI_MODEL` на `gpt-4`

## Дополнительные функции - требуются помощь!
- [ ] Добавление сохранения сессии ([#70](https://github.com/n3d1117/chatgpt-telegram-bot/issues/70), [#71](https://github.com/n3d1117/chatgpt-telegram-bot/issues/71))

PR всегда приветствуются!

## Предварительные требования
- Python 3.9+
- [Telegram bot](https://core.telegram.org/bots#6-botfather) и его токен (см. [руководство](https://core.telegram.org/bots/tutorial#obtain-your-bot-token))
- Учетная запись [OpenAI](https://openai.com) (см. раздел [конфигурации](#configuration))

## Начало работы

### Конфигурация
Настройте конфигурацию, скопировав файл `.env.example` и переименовав его в `.env`, а затем отредактируйте необходимые параметры по желанию:

| Параметр                   | Описание                                                                                                                                                                                                                   |
|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `OPENAI_API_KEY`            | Ваш API-ключ OpenAI, который можно получить [здесь](https://platform.openai.com/account/api-keys)                                                                                                                                 |
| `TELEGRAM_BOT_TOKEN`        | Токен вашего Telegram-бота, полученный с помощью [BotFather](http://t.me/botfather) (см. [руководство](https://core.telegram.org/bots/tutorial#obtain-your-bot-token))                                                                  |
| `ADMIN_USER_IDS`            | Идентификаторы пользователей Telegram администраторов. У этих пользователей есть доступ к особым командам администратора, информации и безоговорочных ограничений бюджета. ID администратора не нужно добавлять в `ALLOWED_TELEGRAM_USER_IDS`. **Обратите внимание**: по умолчанию отсутствуют админы ('-'). |
| `ALLOWED_TELEGRAM_USER_IDS` | Список идентификаторов пользователей Telegram через запятую, которые могут взаимодействовать с ботом (используйте [getidsbot](https://t.me/getidsbot), чтобы найти идентификатор вашего пользователя). **Внимание**: по умолчанию для всех разрешено (`*`).                       |

### Необязательная конфигурация
| Параметр                          | Описание                                                                                                                                                                                                                      | Значение по умолчанию                  |
|------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
| `ENABLE_IMAGE_GENERATION`          | Установка в значение True для включения генерации изображений с помощью команды `/image`                                                                                                                                                                     | true                           |
| `ENABLE_TRANSCRIPTION`             | Установка в значение True для включения транскрипции аудио- и видеосообщений                                                                                                                                                                    | true                           |
| `MONTHLY_USER_BUDGETS`             | Список из $-сумм для каждого пользователя из списка `ALLOWED_TELEGRAM_USER_IDS` для установки индивидуального лимита использования затрат для каждого из них. **Обратите внимание**: по умолчанию *нет лимитов* для всех.                                 | `*`                            |
| `MONTH